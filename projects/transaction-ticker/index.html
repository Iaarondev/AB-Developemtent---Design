<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Ticker</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="root"></div>
    <script>
        // Global state for transactions
        window.transactions = [];
        
        // Function to fetch transactions
        async function fetchTransactions() {
            try {
                const response = await fetch('https://connect.squareup.com/v2/payments', {
                    headers: {
                        'Authorization': `Bearer ${process.env.SQUARE_ACCESS_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                window.transactions = data.payments || [];
                updateDisplay();
            } catch (error) {
                console.error('Error fetching transactions:', error);
                // Fallback data
                window.transactions = [
                    { id: 1, amount_money: { amount: 15000, currency: 'USD' }, created_at: new Date().toISOString() }
                ];
                updateDisplay();
            }
        }

        // Function to format transaction
        function formatTransaction(transaction) {
            const amount = (transaction.amount_money.amount / 100).toFixed(2);
            const date = new Date(transaction.created_at).toLocaleTimeString();
            return `ðŸ’° $${amount} at ${date}`;
        }

        // Function to update display
        function updateDisplay() {
            const ticker = document.createElement('div');
            ticker.className = 'ticker-container';
            
            const content = document.createElement('div');
            content.className = 'ticker-content';
            
            const header = document.createElement('span');
            header.className = 'transaction-item header-text';
            header.textContent = 'LATEST TRANSACTIONS:';
            content.appendChild(header);

            window.transactions.forEach(transaction => {
                const item = document.createElement('span');
                item.className = 'transaction-item';
                item.textContent = formatTransaction(transaction);
                content.appendChild(item);
            });

            ticker.appendChild(content);
            const root = document.getElementById('root');
            root.innerHTML = '';
            root.appendChild(ticker);
        }

        // Initial load and refresh every 5 minutes
        fetchTransactions();
        setInterval(fetchTransactions, 300000);
    </script>
</body>
</html>